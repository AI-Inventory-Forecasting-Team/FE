<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta content="width=device-width, initial-scale=1.0" name="viewport" />

        <title>Logis Bootstrap Template - Service Details</title>
        <meta content="" name="description" />
        <meta content="" name="keywords" />

        <!-- Favicons -->
        <link href="assets/img/favicon.png" rel="icon" />
        <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon" />

        <!-- Google Fonts -->
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link
            href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,600;1,700&family=Poppins:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&family=Inter:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&display=swap"
            rel="stylesheet"
        />

        <!-- Vendor CSS Files -->
        <link
            href="assets/vendor/bootstrap/css/bootstrap.min.css"
            rel="stylesheet"
        />
        <link
            href="assets/vendor/bootstrap-icons/bootstrap-icons.css"
            rel="stylesheet"
        />
        <link
            href="assets/vendor/fontawesome-free/css/all.min.css"
            rel="stylesheet"
        />
        <link
            href="assets/vendor/glightbox/css/glightbox.min.css"
            rel="stylesheet"
        />
        <link
            href="assets/vendor/swiper/swiper-bundle.min.css"
            rel="stylesheet"
        />
        <link href="assets/vendor/aos/aos.css" rel="stylesheet" />

        <!-- Template Main CSS File -->
        <link href="assets/css/main.css" rel="stylesheet" />

        <style>
            #comment {
                overflow: auto; /* 스크롤바를 추가하여 내용이 넘칠 때 스크롤 가능하게 함 */
            }
            #comment::placeholder {
                color: grey;
            }
        </style>

        <!-- =======================================================
  * Template Name: Logis
  * Template URL: https://bootstrapmade.com/logis-bootstrap-logistics-website-template/
  * Updated: Mar 17 2024 with Bootstrap v5.3.3
  * Author: BootstrapMade.com
  * License: https://bootstrapmade.com/license/
  ======================================================== -->
    </head>

    <body>
        <!-- ======= Header ======= -->
        <header id="header" class="header d-flex align-items-center fixed-top">
            <div
                class="container-fluid container-xl d-flex align-items-center justify-content-between"
            >
                <a href="index.html" class="logo d-flex align-items-center">
                    <!-- Uncomment the line below if you also wish to use an image logo -->
                    <!-- <img src="assets/img/logo.png" alt=""> -->
                    <h1>Logis</h1>
                </a>

                <i class="mobile-nav-toggle mobile-nav-show bi bi-list"></i>
                <i class="mobile-nav-toggle mobile-nav-hide d-none bi bi-x"></i>
                <nav id="navbar" class="navbar">
                    <ul>
                        <li><a href="about.html">About</a></li>
                        <li><a href="services.html">Services</a></li>
                        <li><a href="pricing.html">Pricing</a></li>
                        <li><a href="contact.html">Contact</a></li>
                        <li><span class="user-name"></span></li>
                        <li>
                            <a href="#" class="LoginBtn">Login</a>
                        </li>
                        <li><a href="#" id="userNameDisplay"></a></li>
                        <li>
                            <a href="#" id="profileLink">Profile</a>
                        </li>
                        <li><a href="#" class="LogoutBtn">Logout</a></li>
                    </ul>
                </nav>
                <!-- .navbar -->
            </div>
        </header>
        <!-- End Header -->

        <main id="main">
            <!-- ======= Breadcrumbs ======= -->
            <div class="breadcrumbs">
                <div
                    class="page-header d-flex align-items-center"
                    style="background-image: url('assets/img/page-header.jpg')"
                >
                    <div class="container position-relative">
                        <div class="row d-flex justify-content-center">
                            <div class="col-lg-6 text-center">
                                <h2>Service Details</h2>
                                <p>
                                    IF와 함께라면 물류 재고 예측의 불확실성을
                                    극복할 수 있습니다. 당신의 비즈니스를
                                    향상시키고 더 나은 미래를 준비하세요.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
                <nav>
                    <div class="container">
                        <ol>
                            <li><a href="index.html">Home</a></li>
                            <li>Service Details</li>
                        </ol>
                    </div>
                </nav>
            </div>
            <!-- End Breadcrumbs -->

            <!-- ======= Service Details Section ======= -->
            <section id="service-details" class="service-details">
                <div class="container" data-aos="fade-up">
                    <div class="row gy-4">
                        <div class="col-lg-4">
                            <div class="services-list">
                                <a href="#">AI 재고 예측 </a>
                                <a href="#">자동화된 AI 프로세스 </a>
                                <a href="#">최적의 재고 관리 </a>
                                <a href="#">비즈니스 향상 </a>
                                <a href="#">재고 고민 해소 </a>
                                <a href="#">미래 준비 </a>
                            </div>

                            <h4>AI 재고 예측</h4>
                            <p>
                                과거 데이터와 실시간 정보를 AI로 분석하여 정확한
                                재고 수요를 예측하며, 불필요한 재고는 감소시키고
                                비용은 절감되어 생산성과 이익이 향상되며, 수작업
                                없이 AI가 자동으로 신속하고 효율적인 프로세스를
                                처리하여 정확성 높은 재고 운영 체계를
                                구축함으로써 비즈니스 경쟁력을 강화합니다.
                            </p>
                        </div>

                        <div class="col-lg-8">
                            <img />
                            <h4 class="mt-4" id="category">카테고리</h4>
                            <h3 class="mt-4" id="title">제목</h3>
                            <button
                                class="btn btn-danger float-end"
                                id="delete-post-btn"
                            >
                                삭제
                            </button>
                            <button
                                class="btn btn-primary float-end me-1"
                                id="edit-post-btn"
                            >
                                수정
                            </button>
                            <p id="author">작성자</p>
                            <p id="view-count">조회수</p>

                            <p id="content">본문</p>

                            <!-- 좋아요, 스크랩, 공유 버튼 -->
                            <div class="my-4">
                                <button
                                    class="btn btn-outline-primary me-2"
                                    id="like-btn"
                                    style="text-decoration: none"
                                >
                                    좋아요
                                </button>
                                <span id="like-count">0</span>
                                <button
                                    class="btn btn-outline-success float-end"
                                    id="bookmark-btn"
                                >
                                    북마크
                                </button>
                                <button
                                    class="btn btn-outline-info float-end me-4"
                                    id="share-btn"
                                >
                                    공유
                                </button>
                            </div>

                            <hr class="my-4" />

                            <div class="my-5">
                                <form id="commentForm">
                                    <div class="form-group">
                                        <textarea
                                            class="form-control"
                                            id="comment"
                                            rows="3"
                                            placeholder="방금 읽은 콘텐츠 어떠셨나요? 자유롭게 의견을 남겨주세요."
                                            style="resize: none"
                                        ></textarea>
                                    </div>
                                    <button
                                        type="submit"
                                        class="btn btn-primary float-end mt-3"
                                    >
                                        작성하기
                                    </button>
                                </form>
                            </div>
                            <div id="commentsList" class="mt-5">댓글리스트</div>
                        </div>
                    </div>
                </div>
            </section>
            <!-- End Service Details Section -->
        </main>
        <!-- End #main -->

        <!-- ======= Footer ======= -->
        <footer id="footer" class="footer">
            <div class="container">
                <div class="row gy-4">
                    <div class="col-lg-5 col-md-12 footer-info">
                        <a
                            href="index.html"
                            class="logo d-flex align-items-center"
                        >
                            <span>IF </span>
                        </a>
                        <p>물류 혁신을 위한 AI 첨단 기술 기업</p>
                        <div class="social-links d-flex mt-4">
                            <a href="#" class="twitter"
                                ><i class="bi bi-twitter"></i
                            ></a>
                            <a href="#" class="facebook"
                                ><i class="bi bi-facebook"></i
                            ></a>
                            <a href="#" class="instagram"
                                ><i class="bi bi-instagram"></i
                            ></a>
                            <a href="#" class="linkedin"
                                ><i class="bi bi-linkedin"></i
                            ></a>
                        </div>
                    </div>

                    <div class="col-lg-2 col-6 footer-links">
                        <h4>Useful Links</h4>
                        <ul>
                            <li><a href="#">Home</a></li>
                            <li><a href="#">About us</a></li>
                            <li><a href="#">Services</a></li>
                            <li><a href="#">Terms of service</a></li>
                            <li><a href="#">Privacy policy</a></li>
                        </ul>
                    </div>

                    <div class="col-lg-2 col-6 footer-links">
                        <h4>Our Services</h4>
                        <ul>
                            <li><a href="#">AI 기반 재고 예측 솔루션 </a></li>
                            <li><a href="#">수요 데이터 분석 및 최적화 </a></li>
                            <li>
                                <a href="#">물류 프로세스 자동화 시스템 </a>
                            </li>
                            <li>
                                <a href="#">AI 플랫폼 통합 및 구축 컨설팅</a>
                            </li>
                            <li><a href="#">물류 블로그</a></li>
                        </ul>
                    </div>

                    <div
                        class="col-lg-3 col-md-12 footer-contact text-center text-md-start"
                    >
                        <h4>Contact Us</h4>
                        <p>
                            서울특별시 강남구 테헤란로 427, 13층 (삼성동)
                            <br /><br />
                            <strong>전화:</strong> 1800-9876
                            <br />
                            <strong>이메일:</strong> info@logisai.com
                            <br />
                        </p>
                    </div>
                </div>
            </div>

            <div class="container mt-4">
                <div class="copyright">
                    &copy; Copyright <strong><span>IF</span></strong
                    >. All Rights Reserved
                </div>
                <div class="credits">
                    <!-- All the links in the footer should remain intact. -->
                    <!-- You can delete the links only if you purchased the pro version. -->
                    <!-- Licensing information: https://bootstrapmade.com/license/ -->
                    <!-- Purchase the pro version with working PHP/AJAX contact form: https://bootstrapmade.com/logis-bootstrap-logistics-website-template/ -->
                    Designed by
                    <a href="https://bootstrapmade.com/">BootstrapMade</a>
                </div>
            </div>
        </footer>
        <!-- End Footer -->

        <a
            href="#"
            class="scroll-top d-flex align-items-center justify-content-center"
            ><i class="bi bi-arrow-up-short"></i
        ></a>

        <div id="preloader"></div>

        <!-- Vendor JS Files -->
        <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
        <script src="assets/vendor/purecounter/purecounter_vanilla.js"></script>
        <script src="assets/vendor/glightbox/js/glightbox.min.js"></script>
        <script src="assets/vendor/swiper/swiper-bundle.min.js"></script>
        <script src="assets/vendor/aos/aos.js"></script>
        <script src="assets/vendor/php-email-form/validate.js"></script>

        <!-- Template Main JS File -->
        <script src="assets/js/main.js"></script>

        <!-- DOMPurify -->
        <script src="https://cdn.jsdelivr.net/npm/dompurify@2/dist/purify.min.js"></script>
    </body>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const access = localStorage.getItem('access');
            const loginBtnEl = document.querySelector('.LoginBtn');
            const logoutBtnEl = document.querySelector('.LogoutBtn');
            const userNameDisplayEl =
                document.querySelector('#userNameDisplay');
            const commentFormEl = document.getElementById('commentForm');
            const commentTextareaEl = document.getElementById('comment');
            const likeBtn = document.getElementById('like-btn');
            const likeCount = document.getElementById('like-count');
            const bookmarkBtn = document.getElementById('bookmark-btn');
            const isAuthenticated = !!access;
            document.querySelector('.col-lg-8 img').style.width = '800px';
            document.querySelector('.col-lg-8 img').style.height = '600px';

            if (isAuthenticated) {
                // 토큰 갱신
                fetch('http://43.203.201.118/api/token/refresh/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        refresh: localStorage.getItem('refresh'),
                    }),
                })
                    .then((response) => response.json())
                    .then((data) => {
                        const { access: newToken } = data;
                        localStorage.getItem('access', newToken);

                        // 사용자 이름 가져오기
                        fetch('http://43.203.201.118/api/accounts/profile/', {
                            headers: {
                                Authorization: `Bearer ${newToken}`,
                            },
                        })
                            .then((response) => response.json())
                            .then((userData) => {
                                if (userNameDisplayEl) {
                                    userNameDisplayEl.textContent =
                                        userData.username;
                                }
                                if (loginBtnEl) {
                                    loginBtnEl.style.display = 'none';
                                    loginBtnEl.textContent = userData.username;
                                }
                            })
                            .catch((error) => {
                                console.error(
                                    'Error fetching username:',
                                    error
                                );
                            });
                    })
                    .catch((error) => {
                        console.error('Error refreshing token:', error);
                    });
                if (logoutBtnEl) {
                    logoutBtnEl.style.display = 'block';
                    logoutBtnEl.addEventListener('click', () => {
                        // 로컬 스토리지에서 인증 토큰 삭제
                        localStorage.removeItem('access');
                        localStorage.removeItem('refresh');
                        // index.html로 리다이렉트
                        location.href = 'index.html';
                    });
                }
                // URL에서 postId 값을 가져오는 함수
                function getPostIdFromUrl() {
                    const queryParams = new URLSearchParams(
                        window.location.search
                    );
                    console.log(queryParams);
                    return queryParams.get('postId');
                }
                // postId를 사용하여 게시물의 세부 정보를 가져오는 함수
                function fetchPostDetails(postId) {
                    fetch(`http://43.203.201.118/api/posts/${postId}/`, {
                        headers: {
                            Authorization: `Bearer ${localStorage.getItem(
                                'access'
                            )}`,
                        },
                    })
                        .then((response) => response.json())
                        .then((data) => {
                            fillPostDetails(data);
                            updateLikeStatus(data.isLiked);
                            updateLikeCount(data.likesCount);
                            fetchComments(postId);
                        })
                        .catch((error) => {
                            console.error(
                                'Error fetching post details:',
                                error
                            );
                            // 오류 발생 시 적절한 처리를 해야 합니다. 예: 사용자에게 오류 메시지를 보여주기
                        });
                }
                // 가져온 게시물의 세부 정보를 페이지에 채우는 함수
                function fillPostDetails(post) {
                    const postImage =
                        post.image || 'https://picsum.photos/800/600'; // 이미지가 없을 경우 더미 이미지 사용
                    document.querySelector('.col-lg-8 img').src = postImage;
                    document.querySelector('#category').textContent =
                        post.category_name || '카테고리 없음';
                    document.querySelector('#title').textContent =
                        post.title || '제목 없음';
                    document.querySelector('#author').textContent =
                        post.author_username || '작성자 정보 없음';
                    document.querySelector(
                        '#view-count'
                    ).textContent = `조회수: ${
                        post.view_count !== null ? post.view_count : '0'
                    }`;
                    const contentElement = document.getElementById('content');
                    const sanitizedContent = DOMPurify.sanitize(post.content);

                    contentElement.innerHTML = sanitizedContent;
                }

                function updateLikeStatus(isLiked) {
                    isLiked = isLiked; // 좋아요 상태 업데이트
                }

                function updateLikeCount(likeCount) {
                    const likeCountEl = document.getElementById('like-count');
                    likeCountEl.textContent = likeCount;
                }

                const postId = getPostIdFromUrl();
                if (postId) {
                    fetchPostDetails(postId);
                    fetchComments(postId);
                } else {
                    // postId가 없는 경우의 처리를 해야 합니다. 예: 메인 페이지로 리다이렉트
                    alert('유효한 접근이 아닙니다');
                    location.href = 'services.html';
                }

                // 좋아요 상태를 저장할 변수
                let isLiked = false;

                // 좋아요 버튼 클릭 이벤트 리스너
                likeBtn.addEventListener('click', () => {
                    const postId = getPostIdFromUrl();
                    if (postId) {
                        if (isLiked) {
                            // 이미 좋아요 상태인 경우, 좋아요 취소
                            unlikePost(postId);
                        } else {
                            // 좋아요 상태가 아닌 경우, 좋아요
                            likePost(postId);
                        }
                    } else {
                        alert('유효한 접근이 아닙니다');
                        location.href = 'services.html';
                    }
                });

                // 게시물 좋아요 함수
                function likePost(postId) {
                    fetch(`http://43.203.201.118/api/posts/${postId}/like/`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            Authorization: `Bearer ${localStorage.getItem(
                                'access'
                            )}`,
                        },
                        body: JSON.stringify({ post: postId }),
                    })
                        .then((response) => {
                            if (!response.ok) {
                                throw new Error('Network response was not ok');
                            }
                            return response.json();
                        })
                        .then((data) => {
                            console.log('좋아요 처리 성공:', data);
                            if (data.like_count === 0) {
                                isLiked = false;
                            } else {
                                isLiked = true;
                            }
                            updateLikeCount(data.like_count);
                        })
                        .catch((error) => {
                            console.error('좋아요 처리 실패:', error);
                            // 오류 처리 코드를 추가해야 합니다.
                        });
                }

                // 게시물 좋아요 취소 함수
                function unlikePost(postId) {
                    fetch(`http://43.203.201.118/api/posts/${postId}/unlike/`, {
                        method: 'DELETE',
                        headers: {
                            'Content-Type': 'application/json',
                            Authorization: `Bearer ${localStorage.getItem(
                                'access'
                            )}`,
                        },
                    })
                        .then((response) => {
                            if (!response.ok) {
                                throw new Error('Network response was not ok');
                            }
                            return response.json();
                        })
                        .then((data) => {
                            console.log('좋아요 취소 성공:', data);
                            isLiked = false;
                            updateLikeCount(data.like_count);
                        })
                        .catch((error) => {
                            console.error('좋아요 취소 실패:', error);
                            // 오류 처리 코드를 추가해야 합니다.
                        });
                }

                // 좋아요 수 업데이트 함수
                function updateLikeCount(likeCount) {
                    const likeCountEl = document.getElementById('like-count');
                    likeCountEl.textContent = likeCount;
                }

                // 공유하기 버튼 클릭 이벤트 리스너 추가
                document
                    .getElementById('share-btn')
                    .addEventListener('click', function () {
                        const postId = getPostIdFromUrl();
                        if (postId) {
                            // 현재 페이지의 기본 URL을 구성
                            const baseUrl = `${window.location.origin}${window.location.pathname}`;
                            // 현재 페이지의 쿼리 파라미터를 유지하면서 postId 파라미터만 업데이트
                            const queryParams = new URLSearchParams(
                                window.location.search
                            );
                            queryParams.set('postId', postId); // postId 값 업데이트
                            const postUrl = `${baseUrl}?${queryParams.toString()}`; // 최종 공유 URL

                            // URL을 복사하기 위해 임시 textarea 요소를 생성
                            const tempInput =
                                document.createElement('textarea');
                            tempInput.value = postUrl;
                            document.body.appendChild(tempInput);
                            tempInput.select();
                            document.execCommand('copy');
                            document.body.removeChild(tempInput);
                            alert('URL이 클립보드에 복사되었습니다.');
                        } else {
                            alert('공유할 포스트의 ID를 찾을 수 없습니다.');
                        }
                    });
                let isBookmarked = false; // 북마크 상태를 저장할 변수
                // 북마크 버튼 클릭 이벤트 리스너 추가
                bookmarkBtn.addEventListener('click', () => {
                    const postId = getPostIdFromUrl();
                    if (postId) {
                        if (isBookmarked) {
                            // 북마크 해제
                            unbookmarkPost(postId);
                        } else {
                            // 북마크
                            bookmarkPost(postId);
                        }
                    } else {
                        alert('유효한 접근이 아닙니다');
                        location.href = 'services.html';
                    }
                });

                // 게시물 북마크 함수
                function bookmarkPost(postId) {
                    const accessToken = localStorage.getItem('access');
                    fetch(`http://43.203.201.118/api/posts/bookmarks/create/`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            Authorization: `Bearer ${accessToken}`,
                        },
                        body: JSON.stringify({ post: postId }),
                    })
                        .then((response) => response.json())
                        .then((data) => {
                            if (data.id) {
                                // 가정: 응답에서 북마크의 ID가 'id' 필드에 포함되어 있다고 가정
                                localStorage.setItem('bookmarkId', data.id); // 북마크 ID를 로컬 스토리지에 저장
                                isBookmarked = true;
                                alert('북마크되었습니다.');
                                updateBookmarkButton(true);
                            } else {
                                alert('북마크에 실패했습니다.');
                            }
                        })
                        .catch((error) => {
                            console.error('북마크 중 오류 발생:', error);
                        });
                }

                function unbookmarkPost() {
                    const accessToken = localStorage.getItem('access');
                    const bookmarkId = localStorage.getItem('bookmarkId'); // 로컬 스토리지에서 북마크 ID 가져오기

                    fetch(
                        `http://43.203.201.118/api/posts/bookmarks/${bookmarkId}/`,
                        {
                            method: 'DELETE',
                            headers: {
                                Authorization: `Bearer ${accessToken}`,
                            },
                        }
                    )
                        .then((response) => {
                            if (response.ok) {
                                localStorage.removeItem('bookmarkId'); // 북마크 해제 후 ID 삭제
                                isBookmarked = false;
                                alert('북마크가 해제되었습니다.');
                                updateBookmarkButton(false);
                            } else {
                                alert('북마크 해제에 실패했습니다.');
                            }
                        })
                        .catch((error) => {
                            console.error('북마크 해제 중 오류 발생:', error);
                        });
                }

                function updateBookmarkButton(isBookmarked) {
                    const bookmarkBtn = document.getElementById('bookmark-btn');
                    if (isBookmarked) {
                        bookmarkBtn.textContent = '북마크 해제';
                        // 또는 아이콘 변경
                    } else {
                        bookmarkBtn.textContent = '북마크';
                        // 또는 아이콘 변경
                    }
                }

                // 댓글 작성 함수
                function createComment(postId, content) {
                    const requestBody = {
                        post: postId,
                        content: content,
                    };

                    fetch(
                        `http://43.203.201.118/api/posts/${postId}/comments/create/`,
                        {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                Authorization: `Bearer ${localStorage.getItem(
                                    'access'
                                )}`,
                            },
                            body: JSON.stringify(requestBody),
                        }
                    )
                        .then((response) => response.json())
                        .then((data) => {
                            console.log('댓글 작성 성공:', data);
                            fetchComments(postId); // 댓글 목록 새로고침
                        })
                        .catch((error) => {
                            console.error('댓글 작성 실패:', error);
                            // 오류 처리 코드를 추가해야 합니다.
                        });
                }

                // 댓글 조회 함수
                function fetchComments(postId) {
                    fetch(
                        `http://43.203.201.118/api/posts/${postId}/comments/`,
                        {
                            headers: {
                                Authorization: `Bearer ${localStorage.getItem(
                                    'access'
                                )}`,
                            },
                        }
                    )
                        .then((response) => response.json())
                        .then((data) => {
                            const commentsListEl =
                                document.getElementById('commentsList');
                            commentsListEl.innerHTML = ''; // 기존 댓글 목록 초기화

                            if (Array.isArray(data.results)) {
                                data.results.forEach((comment) => {
                                    const commentEl =
                                        document.createElement('div');
                                    commentEl.style.marginBottom = '10px';

                                    const commentHeaderEl =
                                        document.createElement('div');
                                    commentHeaderEl.style.display = 'flex';
                                    commentHeaderEl.style.justifyContent =
                                        'space-between';
                                    commentHeaderEl.style.alignItems = 'center';

                                    const commentInfoEl =
                                        document.createElement('div');
                                    commentInfoEl.style.display = 'flex';
                                    commentInfoEl.style.alignItems = 'center';

                                    const avatarEl =
                                        document.createElement('img');
                                    avatarEl.src =
                                        comment.author_avatar ||
                                        'https://picsum.photos/50/50';
                                    avatarEl.alt = 'Avatar';
                                    avatarEl.style.width = '30px';
                                    avatarEl.style.height = '30px';
                                    avatarEl.style.borderRadius = '50%';
                                    avatarEl.style.marginRight = '5px';

                                    const authorEl =
                                        document.createElement('strong');
                                    authorEl.textContent =
                                        comment.author_username;

                                    const dateEl =
                                        document.createElement('span');
                                    dateEl.textContent = new Date(
                                        comment.created_at
                                    ).toLocaleString();
                                    dateEl.style.marginLeft = '10px';
                                    dateEl.style.fontSize = '12px';
                                    dateEl.style.color = 'gray';

                                    commentInfoEl.appendChild(avatarEl);
                                    commentInfoEl.appendChild(authorEl);
                                    commentInfoEl.appendChild(dateEl);

                                    commentHeaderEl.appendChild(commentInfoEl);

                                    if (
                                        comment.author_username ===
                                        userNameDisplayEl.textContent
                                    ) {
                                        const btnContainer =
                                            document.createElement('div');

                                        const editBtn =
                                            document.createElement('button');
                                        editBtn.textContent = '수정';
                                        editBtn.style.marginLeft = '5px';
                                        editBtn.addEventListener(
                                            'click',
                                            () => {
                                                const postId =
                                                    getPostIdFromUrl();
                                                editComment(comment.id, postId);
                                            }
                                        );

                                        const deleteBtn =
                                            document.createElement('button');
                                        deleteBtn.textContent = '삭제';
                                        deleteBtn.style.marginLeft = '5px';
                                        deleteBtn.addEventListener(
                                            'click',
                                            () => {
                                                deleteComment(comment.id);
                                            }
                                        );

                                        btnContainer.appendChild(editBtn);
                                        btnContainer.appendChild(deleteBtn);
                                        commentHeaderEl.appendChild(
                                            btnContainer
                                        );
                                    }

                                    const contentEl =
                                        document.createElement('p');
                                    contentEl.textContent = comment.content;

                                    commentEl.appendChild(commentHeaderEl);
                                    commentEl.appendChild(contentEl);

                                    // 대댓글 작성 버튼 생성
                                    const replyButtonEl =
                                        document.createElement('button');
                                    replyButtonEl.textContent = '대댓글 작성';
                                    replyButtonEl.className =
                                        'btn btn-outline-primary btn-sm';
                                    replyButtonEl.addEventListener(
                                        'click',
                                        () => {
                                            toggleReplyForm(comment.id);
                                        }
                                    );

                                    // 대댓글 작성 폼 생성
                                    const replyFormEl =
                                        document.createElement('div');
                                    replyFormEl.id = `replyForm-${comment.id}`;
                                    replyFormEl.className = 'my-3';
                                    replyFormEl.style.display = 'none';
                                    replyFormEl.innerHTML = `
                                        <form class="replyForm">
                                        <div class="form-group">
                                            <textarea class="form-control replyContent" rows="3" placeholder="대댓글을 입력하세요." style="resize: none;"></textarea>
                                        </div>
                                        <button type="submit" class="btn btn-primary btn-sm float-end mt-2">작성하기</button>
                                        </form>
                                    `;

                                    // 대댓글 목록 생성
                                    const repliesListEl =
                                        document.createElement('div');
                                    repliesListEl.id = `repliesList-${comment.id}`;
                                    repliesListEl.dataset.commentId = comment.id;

                                    commentEl.appendChild(replyButtonEl);
                                    commentEl.appendChild(replyFormEl);
                                    commentEl.appendChild(repliesListEl);
                                    // 대댓글 조회 및 렌더링
                                    fetchReplies(comment.id, commentEl);
                                    commentsListEl.appendChild(commentEl);
                                });
                            } else {
                                console.error(
                                    '댓글 데이터가 배열 형태가 아닙니다:',
                                    data
                                );
                            }
                        })
                        .catch((error) => {
                            console.error('댓글 조회 실패:', error);
                        });
                }

                // 댓글 수정 함수
                function editComment(commentId, postId) {
                    const newContent = prompt('댓글을 수정하세요:');
                    console.log(newContent);
                    if (newContent) {
                        fetch(
                            `http://43.203.201.118/api/posts/${postId}/comments/${commentId}/`,
                            {
                                method: 'PUT',
                                headers: {
                                    'Content-Type': 'application/json',
                                    Authorization: `Bearer ${localStorage.getItem(
                                        'access'
                                    )}`,
                                },
                                body: JSON.stringify({
                                    post: postId,
                                    content: newContent,
                                }),
                            }
                        )
                            .then((response) => response.json())
                            .then((data) => {
                                console.log('댓글 수정 성공:', data);
                                fetchComments(postId); // 댓글 목록 새로고침

                                const commentId = data.comment; // 대댓글이 속한 댓글의 ID
                                const repliesListEl = document.querySelector(
                                    `[data-comment-id="${commentId}"] #repliesList-${commentId}`
                                );
                                if (repliesListEl) {
                                    const replyEl = repliesListEl.querySelector(
                                        `[data-reply-id="${replyId}"]`
                                    );
                                    if (replyEl) {
                                        const contentEl =
                                            replyEl.querySelector('p');
                                        if (contentEl) {
                                            contentEl.textContent =
                                                data.content;
                                        }
                                    }
                                }
                            })
                            .catch((error) => {
                                console.error('댓글 수정 실패:', error);
                            });
                    }
                }

                // 댓글 삭제 함수
                function deleteComment(commentId) {
                    if (confirm('댓글을 삭제하시겠습니까?')) {
                        fetch(
                            `http://43.203.201.118/api/posts/${postId}/comments/${commentId}/`,
                            {
                                method: 'DELETE',
                                headers: {
                                    Authorization: `Bearer ${localStorage.getItem(
                                        'access'
                                    )}`,
                                },
                            }
                        )
                            .then((response) => {
                                if (response.ok) {
                                    console.log('댓글 삭제 성공');
                                    fetchComments(getPostIdFromUrl()); // 댓글 목록 새로고침
                                } else {
                                    console.error('댓글 삭제 실패');
                                }
                            })
                            .catch((error) => {
                                console.error('댓글 삭제 실패:', error);
                            });
                    }
                }
                // 댓글 작성 폼 제출 이벤트 리스너
                commentFormEl.addEventListener('submit', (event) => {
                    event.preventDefault();
                    const postId = getPostIdFromUrl();
                    const commentContent = commentTextareaEl.value.trim();

                    if (isAuthenticated && postId && commentContent) {
                        createComment(postId, commentContent);
                        commentTextareaEl.value = ''; // 댓글 작성 후 textarea 초기화
                    } else {
                        alert('내용을 입력해주세요');
                        location.href = 'service-details.html';
                    }
                });
                // 대댓글 작성 폼 토글 함수
                function toggleReplyForm(commentId) {
                    const replyFormEl = document.getElementById(
                        `replyForm-${commentId}`
                    );
                    if (replyFormEl.style.display === 'none') {
                        replyFormEl.style.display = 'block';
                        replyFormEl.setAttribute('data-comment-id', commentId);
                        replyFormEl.setAttribute('data-post-id', postId);

                        // 대댓글 작성 폼에 이벤트 리스너 추가
                        const replyForm =
                            replyFormEl.querySelector('.replyForm');
                        replyForm.addEventListener('submit', (event) => {
                            event.preventDefault();
                            const replyContent = replyForm
                                .querySelector('.replyContent')
                                .value.trim();
                            if (replyContent) {
                                createReply(commentId, replyContent);
                                replyForm.querySelector('.replyContent').value =
                                    ''; // 대댓글 작성 후 textarea 초기화
                            }
                        });
                    } else {
                        replyFormEl.style.display = 'none';
                    }
                }

                // 대댓글 작성 함수
                function createReply(commentId, content) {
                    const requestBody = {
                        comment: commentId,
                        content: content,
                    };

                    fetch(
                        `http://43.203.201.118/api/posts/${postId}/comments/${commentId}/replies/create/`,
                        {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                Authorization: `Bearer ${localStorage.getItem(
                                    'access'
                                )}`,
                            },
                            body: JSON.stringify(requestBody),
                        }
                    )
                        .then((response) => response.json())
                        .then((data) => {
                            console.log('대댓글 작성 성공:', data);
                            fetchReplies(commentId); // 대댓글 목록 새로고침
                        })
                        .catch((error) => {
                            console.error('대댓글 작성 실패:', error);
                            // 오류 처리 코드를 추가해야 합니다.
                        });
                }

                // 대댓글 조회 함수
                function fetchReplies(commentId) {
                    fetch(
                        `http://43.203.201.118/api/posts/${postId}/comments/${commentId}/replies/`,
                        {
                            method: 'GET',
                            headers: {
                                Authorization: `Bearer ${localStorage.getItem(
                                    'access'
                                )}`,
                            },
                        }
                    )
                        .then((response) => response.json())
                        .then((data) => {
                            const repliesListEl = document.getElementById(
                                `repliesList-${commentId}`
                            );
                            repliesListEl.innerHTML = ''; // 기존 대댓글 목록 초기화

                            if (Array.isArray(data.results)) {
                                data.results.forEach((reply) => {
                                    const replyEl =
                                        document.createElement('div');
                                    replyEl.dataset.commentId = commentId;
                                    replyEl.dataset.replyId = reply.id;
                                    replyEl.style.paddingLeft = '30px';
                                    replyEl.style.borderLeft =
                                        '2px solid lightgray';
                                    replyEl.style.marginBottom = '10px';

                                    const replyHeaderEl =
                                        document.createElement('div');
                                    replyHeaderEl.style.display = 'flex';
                                    replyHeaderEl.style.justifyContent =
                                        'space-between';
                                    replyHeaderEl.style.alignItems = 'center';

                                    const replyInfoEl =
                                        document.createElement('div');
                                    replyInfoEl.style.display = 'flex';
                                    replyInfoEl.style.alignItems = 'center';

                                    const avatarEl =
                                        document.createElement('img');
                                    avatarEl.src =
                                        reply.author_avatar ||
                                        'https://picsum.photos/50/50';
                                    avatarEl.alt = 'Avatar';
                                    avatarEl.style.width = '30px';
                                    avatarEl.style.height = '30px';
                                    avatarEl.style.borderRadius = '50%';
                                    avatarEl.style.marginRight = '5px';

                                    const authorEl =
                                        document.createElement('strong');
                                    authorEl.textContent =
                                        reply.author_username;

                                    const dateEl =
                                        document.createElement('span');
                                    dateEl.textContent = new Date(
                                        reply.created_at
                                    ).toLocaleString();
                                    dateEl.style.marginLeft = '10px';
                                    dateEl.style.fontSize = '12px';
                                    dateEl.style.color = 'gray';

                                    replyInfoEl.appendChild(avatarEl);
                                    replyInfoEl.appendChild(authorEl);
                                    replyInfoEl.appendChild(dateEl);

                                    replyHeaderEl.appendChild(replyInfoEl);

                                    if (
                                        reply.author_username ===
                                        userNameDisplayEl.textContent
                                    ) {
                                        const btnContainer =
                                            document.createElement('div');

                                        const editBtn =
                                            document.createElement('button');
                                        editBtn.textContent = '수정';
                                        editBtn.style.marginLeft = '5px';
                                        editBtn.style.backgroundColor = 'white';
                                        editBtn.style.color = 'black';
                                        editBtn.style.border = '1px solid #ccc';
                                        editBtn.style.padding = '3px 10px';
                                        editBtn.style.borderRadius = '4px';
                                        editBtn.style.cursor = 'pointer';
                                        editBtn.style.fontSize = '14px';
                                        editBtn.addEventListener(
                                            'click',
                                            () => {
                                                editReply(reply.id);
                                            }
                                        );

                                        const deleteBtn =
                                            document.createElement('button');
                                        deleteBtn.textContent = '삭제';
                                        deleteBtn.style.marginLeft = '5px';
                                        deleteBtn.style.backgroundColor =
                                            'white';
                                        deleteBtn.style.color = 'black';
                                        deleteBtn.style.border =
                                            '1px solid #ccc';
                                        deleteBtn.style.padding = '3px 10px';
                                        deleteBtn.style.borderRadius = '4px';
                                        deleteBtn.style.cursor = 'pointer';
                                        deleteBtn.style.fontSize = '14px';
                                        deleteBtn.addEventListener(
                                            'click',
                                            () => {
                                                deleteReply(reply.id);
                                            }
                                        );

                                        btnContainer.appendChild(editBtn);
                                        btnContainer.appendChild(deleteBtn);
                                        replyHeaderEl.appendChild(btnContainer);
                                    }

                                    const contentEl =
                                        document.createElement('p');
                                    contentEl.textContent = reply.content;

                                    replyEl.appendChild(replyHeaderEl);
                                    replyEl.appendChild(contentEl);

                                    repliesListEl.appendChild(replyEl);
                                });
                            } else {
                                console.error(
                                    '대댓글 데이터가 배열 형태가 아닙니다:',
                                    data
                                );
                            }
                        })
                        .catch((error) => {
                            console.error('대댓글 조회 실패:', error);
                        });
                }

                // 대댓글 수정 함수
                function editReply(replyId) {
                    const newContent = prompt('대댓글을 수정하세요:');
                    if (newContent) {
                        const replyEl = document.querySelector(
                            `[data-reply-id="${replyId}"]`
                        );
                        const commentId = replyEl.dataset.commentId;
                        fetch(
                            `http://43.203.201.118/api/posts/${postId}/comments/replies/${replyId}/`,
                            {
                                method: 'PUT',
                                headers: {
                                    'Content-Type': 'application/json',
                                    Authorization: `Bearer ${localStorage.getItem(
                                        'access'
                                    )}`,
                                },
                                body: JSON.stringify({
                                    comment: commentId,
                                    content: newContent,
                                }),
                            }
                        )
                            .then((response) => {
                                if (!response.ok) {
                                    throw new Error(
                                        'Network response was not ok'
                                    );
                                }
                                return response.json();
                            })
                            .then((data) => {
                                console.log('대댓글 수정 성공:', data);
                                const commentId = data.comment;
                                const repliesListEl = document.querySelector(
                                    `[data-comment-id="${commentId}"] #repliesList-${commentId}`
                                );
                                if (repliesListEl) {
                                    const replyEl = repliesListEl.querySelector(
                                        `[data-reply-id="${replyId}"]`
                                    );
                                    if (replyEl) {
                                        const contentEl =
                                            replyEl.querySelector('p');
                                        if (contentEl) {
                                            contentEl.textContent =
                                                data.content;
                                        }
                                    }
                                }
                                fetchReplies(commentId);
                            })
                            .catch((error) => {
                                console.error('대댓글 수정 실패:', error);
                            });
                    }
                }

                // 대댓글 삭제 함수
                function deleteReply(replyId) {
                    if (confirm('대댓글을 삭제하시겠습니까?')) {
                        fetch(
                            `http://43.203.201.118/api/posts/${postId}/comments/replies/${replyId}/`,
                            {
                                method: 'DELETE',
                                headers: {
                                    Authorization: `Bearer ${localStorage.getItem(
                                        'access'
                                    )}`,
                                },
                            }
                        )
                            .then((response) => {
                                if (!response.ok) {
                                    throw new Error(
                                        'Network response was not ok'
                                    );
                                }
                                console.log('대댓글 삭제 성공');
                                fetchComments(getPostIdFromUrl()); // 대댓글 목록 새로고침
                            })
                            .catch((error) => {
                                console.error('대댓글 삭제 실패:', error);
                            });
                    }
                }
                // 게시물 삭제 함수
                function deletePost(postId) {
                    fetch(`http://43.203.201.118/api/posts/${postId}/delete/`, {
                        method: 'DELETE',
                        headers: {
                            'Content-Type': 'application/json',
                            Authorization: `Bearer ${localStorage.getItem(
                                'access'
                            )}`,
                        },
                    })
                        .then((response) => {
                            if (response.ok) {
                                alert('게시물이 삭제되었습니다.');
                                location.href = 'services.html';
                            } else {
                                alert('게시물 삭제에 실패했습니다.');
                            }
                        })
                        .catch((error) => {
                            console.error('게시물 삭제 중 오류 발생:', error);
                        });
                }

                // 댓글 작성 폼 제출 이벤트 리스너
                commentFormEl.addEventListener('submit', (event) => {
                    event.preventDefault();
                    const postId = getPostIdFromUrl();
                    const commentContent = commentTextareaEl.value.trim();

                    if (isAuthenticated && postId && commentContent) {
                        createComment(postId, commentContent);
                        commentTextareaEl.value = ''; // 댓글 작성 후 textarea 초기화
                    } else {
                        alert('내용을 입력해주세요');
                        location.href = 'service-details.html';
                    }
                });
                // 게시물 삭제 함수
                function deletePost(postId) {
                    fetch(`http://43.203.201.118/api/posts/${postId}/delete/`, {
                        method: 'DELETE',
                        headers: {
                            'Content-Type': 'application/json',
                            Authorization: `Bearer ${localStorage.getItem(
                                'access'
                            )}`,
                        },
                    })
                        .then((response) => {
                            if (response.ok) {
                                alert('게시물이 삭제되었습니다.');
                                location.href = 'services.html';
                            } else {
                                alert('게시물 삭제에 실패했습니다.');
                            }
                        })
                        .catch((error) => {
                            console.error('게시물 삭제 중 오류 발생:', error);
                        });
                }

                // 삭제 버튼 클릭 이벤트 리스너 추가
                const deletePostBtn =
                    document.getElementById('delete-post-btn');
                if (deletePostBtn) {
                    deletePostBtn.addEventListener('click', () => {
                        const postId = getPostIdFromUrl(); // postId를 여기서 가져옴
                        if (postId) {
                            deletePost(postId);
                        } else {
                            alert('유효한 접근이 아닙니다');
                            location.href = 'services.html';
                        }
                    });
                }
                const editPostBtn = document.getElementById('edit-post-btn');
                if (editPostBtn) {
                    editPostBtn.addEventListener('click', () => {
                        // 수정 모달 창 열기 또는 수정 폼 렌더링 등의 로직 추가
                        location.href = `post-update.html?postId=${postId}`;
                    });
                }
                const profileLinkEl = document.getElementById('profileLink');
                profileLinkEl.addEventListener('click', () => {
                    location.href = 'profile.html';
                });
            } else {
                // 로그인 되어 있지 않은 경우
                if (loginBtnEl) {
                    loginBtnEl.style.display = 'block';
                    // 로그인 버튼에 이벤트 리스너 추가
                    loginBtnEl.addEventListener('click', () => {
                        // login.html로 리다이렉트
                        location.href = 'login.html';
                    });
                }
                if (logoutBtnEl) {
                    logoutBtnEl.style.display = 'none';
                }
            }
        });
    </script>
</html>
